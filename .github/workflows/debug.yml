name: Debug Docker Login

on:
  workflow_dispatch:

jobs:
  debug:
    name: Debug Docker Login
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Test Docker Hub Connection
        run: |
          echo "Testing Docker Hub connection..."
          echo ""

          # 检查 secrets 是否设置（仅显示是否设置）
          if [ -n "${{ secrets.DOCKER_USERNAME }}" ]; then
            echo "✅ DOCKER_USERNAME is set"
          else
            echo "❌ DOCKER_USERNAME is NOT set"
          fi

          if [ -n "${{ secrets.DOCKER_PASSWORD }}" ]; then
            echo "✅ DOCKER_PASSWORD is set (length: $(echo '${{ secrets.DOCKER_PASSWORD }}' | wc -c))"
          else
            echo "❌ DOCKER_PASSWORD is NOT set"
          fi

          echo ""
          echo "Attempting Docker Hub login..."

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        id: docker-login
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Report Login Result
        run: |
          if [ "${{ steps.docker-login.outcome }}" == "success" ]; then
            echo "✅ Docker Hub login successful!"
            echo ""
            echo "You can now push images."
          else
            echo "❌ Docker Hub login failed!"
            echo ""
            echo "Please check:"
            echo "1. Your Docker Hub username is correct: '${{ secrets.DOCKER_USERNAME }}'"
            echo "2. Your Docker Hub password/token is correct"
            echo "3. Your token has 'Read & Write' permissions"
            echo ""
            echo "To verify:"
            echo "1. Go to https://hub.docker.com/"
            echo "2. Try to login manually: docker login -u <username> -p <token>"
