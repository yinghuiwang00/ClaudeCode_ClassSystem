
● 我来为你总结如何测试这个Class Booking System应用的各个功能。

  测试准备

  1. 访问Swagger UI: http://localhost:8080/swagger-ui.html
  2. 访问H2控制台: http://localhost:8080/h2-console
    - JDBC URL: jdbc:h2:mem:bookingdb
    - 用户名: sa
    - 密码: (留空)

  功能测试步骤

  1. 用户注册和登录

  # 注册用户
  POST /api/v1/auth/register
  {
    "name": "Test User",
    "email": "test@example.com",
    "password": "password123"
  }

  # 用户登录
  POST /api/v1/auth/login
  {
    "email": "test@example.com",
    "password": "password123"
  }


  保存返回的JWT token，后续请求需要在Authorization头中添加: Bearer <token>

  2. 查看课程列表（无需认证）

  # 查看所有课程
  GET /api/v1/classes

  # 只查看可预订的课程
  GET /api/v1/classes?availableOnly=true

  # 查看特定状态的课程
  GET /api/v1/classes?status=SCHEDULED


  3. 创建课程（需要ADMIN或INSTRUCTOR角色）

  # 首先需要将用户角色改为ADMIN
  # 在H2控制台执行: UPDATE users SET role = 'ROLE_ADMIN' WHERE email = 'test@example.com';

  # 然后创建课程
  POST /api/v1/classes
  {
    "name": "Yoga Class",
    "description": "Morning yoga session",
    "instructorId": 1,
    "startTime": "2026-02-18T09:00:00",
    "endTime": "2026-02-18T10:00:00",
    "capacity": 20
  }


  4. 预订课程（需要认证）

  # 预订课程
  POST /api/v1/bookings
  {
    "classScheduleId": 1
  }

  # 查看我的预订
  GET /api/v1/bookings/my-bookings

  # 取消预订
  DELETE /api/v1/bookings/{bookingId}


  5. 用户管理（ADMIN功能）

  # 查看所有用户
  GET /api/v1/users

  # 查看当前用户信息
  GET /api/v1/users/me


  6. 并发测试（验证防超订功能）

  # 同时发送多个预订请求，测试系统是否能防止超订
  # 可以使用并发工具或同时打开多个Swagger页面发送请求


  测试场景建议

  1. 正常流程测试：
    - 注册 → 登录 → 查看课程 → 预订 → 查看预订 → 取消预订
  2. 边界条件测试：
    - 尝试预订已满的课程
    - 尝试预订已经开始的课程
    - 尝试重复预订同一课程
    - 尝试取消不存在的预订
  3. 权限测试：
    - 未认证用户尝试访问受保护端点
    - USER角色尝试创建课程
    - ADMIN角色访问所有功能
  4. 数据验证：
    - 在H2控制台查看数据变化
    - 验证current_bookings计数器是否正确更新
    - 检查booking记录的创建和删除

  调试技巧

  1. 查看应用日志：控制台会输出SQL语句和业务日志
  2. 使用H2控制台：实时查看数据库状态
  3. Swagger UI授权：点击"Authorize"按钮输入Bearer token
  4. 错误处理：观察返回的错误信息和HTTP状态码

  通过这些步骤，你可以全面测试应用的认证、授权、课程管理和预订功能。